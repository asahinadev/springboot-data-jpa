<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" class="h-100" layout:decorator="_common/layout">

<head>

<meta charset="UTF-8">
<link rel="contents" th:href="@{/}" id="index_url">

<title>SIGN UP</title>

<script>
$(function(){
	var $form = $("form.card-body");
	$form.on("submit", function() {

		if ($form.find(":invalid").length > 0) {
			alert("入力項目にエラーがあります。");
			return false;
		}

		var method = $form.attr("method");
		var action = $form.attr("action")
		var data = JSON.stringify({
	        username: $form.find("input#username").val(),
	        email:    $form.find("input#email").val(),
	        password: $form.find("input#password").val(),
        });
        
		var success = function (data, status) {
			alert("登録が完了しました。");
            location.href = "[[@{/login}]]?signup";
		};
		
		var error = function(xhr, status, errorThrown) {
			alert("サーバー側でエラーが発生しました。");
			console.log([xhr, status, errorThrown]);

			var json_data = JSON.parse(xhr.responseText);
        	for (var i  in json_data) {
	        	console.log(json_data[i]);
	        	console.log(json_data[i].code);
	        	console.log(json_data[i].default_message);
        	}
		}

		var complete = function(){
		}
        
		
		$.ajax({
	        type:        method,
	        url:         action,
	        data:        data ,
	        contentType: 'application/json', 
	        dataType:    'json',
	        success:     success ,
	        error:       error,
	        complete:    complete 
	    });		
		return false;
	});
});
</script>

</head>

<div layout:fragment="contents" class="pt-5">

	<div class="w-50 m-auto">

		<div class="card">

			<form class="card-body was-validated" novalidate th:object="${form}" method="POST" th:action="@{/signup}">

				<div class="form-group form-row">
					<label class="col-4" for="username">アカウント</label>
					<!--  -->
					<input class="form-control col" th:field="*{username}" required pattern="^[a-zA-Z0-9]{8,16}">
					<div class="valid-feedback">必須項目／半角英数／8～16文字</div>
					<div class="invalid-feedback">必須項目／半角英数／8～16文字</div>
				</div>

				<div class="form-group form-row">
					<label class="col-4" for="email">メールアドレス</label>
					<!--  -->
					<input class="form-control col" th:field="*{email}" type="email" required pattern=".*@.*\..*">
					<div class="valid-feedback">必須項目／メールアドレス形式</div>
					<div class="invalid-feedback">必須項目／メールアドレス形式</div>
				</div>

				<div class="form-group form-row">
					<label class="col-4" for="password">パスワード</label>
					<!--  -->
					<input class="form-control col" th:field="*{password}" type="password" required pattern="^[a-zA-Z0-9]{8,16}">
					<div class="valid-feedback">必須項目／半角英数／8～16文字</div>
					<div class="invalid-feedback">必須項目／半角英数／8～16文字</div>
				</div>

				<div class="row">
					<div class="offset-8 col-4">
						<button class="btn btn-primary btn-block">登録</button>
					</div>
				</div>

			</form>

		</div>

		<div class="list-group mt-5">
			<div class="list-group-item">
				<a href="#" th:href="@{/login}">ログイン</a>
			</div>
		</div>
	</div>

</div>

</body>

</html>


